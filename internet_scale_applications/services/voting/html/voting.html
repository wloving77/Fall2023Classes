<!DOCTYPE html>

<html>

<head>
    <title> YEET </title>
</head>

<body>

    <div class="tableContainer">
        <table id="voterTable">
            <thead>
                <tr>
                    <th>Voters</th>
                    <th>Votes to Cast</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

    <div class="tableContainer">
        <table id="candidateTable">
            <thead>
                <tr>
                    <th>Candidates</th>
                    <th>Votes</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

    <br>
    <button id="getVoters" onClick="fetchAndDisplayVoters()">View Voters?</button>
    <br><br>
    <button id="getCandidates" onClick="fetchAndDisplayCandidates()">View Candidates?</button>


</body>

</html>

<script>

    // all API endpoints will be in this object:
    let endpoints = {
        "candidates": "/api/voting/candidates",
        "voters": "/api/voting/voters",
    }
    /* API Request FUNCTIONS */

    async function apiGETRequest(apiUrl) {

        return fetch(apiUrl, { method: "GET" })
            .then(response => {
                if (!response.ok) {
                    console.log(`Unknown Error Fetching from ${apiUrl} -> Error Code: ${response.status}, Status: ${response.statusText}`);
                    return null;
                }
                return response.json();
            })
            .catch(error => {
                console.log(`Error Handling Promise in apiGETRequest: ${error}`);
                return null;
            })
    }

    /* DOM FUNCTIONS */

    //separate module to enforce DRY as we perform the same actions for displaying both candidates and voters

    function displayVoters(voters) {
        let voterTable = document.getElementById("voterTable");
        let candidateTable = document.getElementById("candidateTable");

        if (!voters) {
            console.error("Voters variable invalid in displayVoters()");
            return;
        }

        voterTable.querySelector("tbody").innerHTML = "";
        candidateTable.style.display = "none";

        for (let i = 0; i < voters.length; i++) {
            let newRow = document.createElement("tr");
            let voterName = document.createElement("td");
            let voteCount = document.createElement("td");

            voterName.innerHTML = voters[i].name;
            voteCount.innerHTML = voters[i].votes_avail;

            newRow.appendChild(voterName);
            newRow.appendChild(voteCount);

            newRow.classList.add("tableRow");
            newRow.id = "voterRow-" + i;


            voterTable.querySelector("tbody").appendChild(newRow);
        }

        voterTable.style.display = "block";
    }

    function displayCandidates(candidates) {
        let candidateTable = document.getElementById("candidateTable");
        let voterTable = document.getElementById("voterTable");

        if (!candidates) {
            console.error("Candidates variable invalid in displayCandidates()");
            return;
        }

        candidateTable.querySelector("tbody").innerHTML = "";
        voterTable.style.display = "none";


        for (let i = 0; i < candidates.length; i++) {
            let newRow = document.createElement("tr");

            let name = document.createElement("td");
            let numVotes = document.createElement("td");

            name.innerHTML = candidates[i].name;
            numVotes.innerHTML = candidates[i].votes;

            newRow.appendChild(name);
            newRow.appendChild(numVotes)

            newRow.classList.add("tableRow");
            newRow.id = "candidateRow-" + i;

            candidateTable.querySelector("tbody").appendChild(newRow);

        }

        candidateTable.style.display = "block";

    }


    /* Functions Called from DOM */

    function fetchAndDisplayVoters() {
        apiGETRequest(endpoints['voters']).then(data => {
            displayVoters(data);
        }).catch(err => {
            console.error("Error in fetchAndDisplayVoters()" + err);
        });
    }


    function fetchAndDisplayCandidates() {
        apiGETRequest(endpoints['candidates']).then(data => {
            displayCandidates(data);
        }).catch(err => {
            console.error("Error Displaying Candidates " + err);
        })
    }

</script>


<style>
    #voterTable {
        display: none;
    }

    #candidateTable {
        display: none;
    }

    .tableRow:hover {
        cursor: pointer;
        background-color: aqua;
    }

    .tableContainer {
        padding: 5px;
        border-collapse: collapse;
    }

    table {
        border: 2px solid black;
        padding: 10px;
    }
</style>